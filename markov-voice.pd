#N canvas 117 24 1228 755 10;
#X obj 263 49 tgl 15 0 empty empty empty 17 7 0 10 -262144 -1 -1 0
1;
#X obj 203 203 notes-to-index;
#X text 863 665 This patch is adapted from the monks.pd patch provided
by Michael Edwards at http://michael-edwards.org/class/edi/music2d/markov.html
;
#X obj 266 235 loadbang;
#X obj 266 260 12;
#X obj 203 164 symbol c;
#X obj 214 109 t b s;
#X obj 203 320 list;
#X obj 135 467 alternatively-combine-two-lists;
#X obj 134 447 list;
#X msg 131 419 c cs d ds e f fs g gs a as b;
#X obj 203 359 t b l;
#X obj 134 490 t b l;
#X floatatom 17 616 5 0 0 0 - - -, f 5;
#X obj 575 727 noteout;
#X obj 574 702 makenote 80 500;
#X obj 1098 596 pgmout 1;
#X obj 1099 525 loadbang;
#X obj 7 31 t s;
#X obj 1030 525 bng 15 250 50 0 empty empty empty 17 7 0 10 -262144
-1 -1;
#X obj 214 70 spigot 1;
#X obj 106 10 inlet;
#X obj 1096 562 54;
#X text 144 9 starting note;
#X obj 263 10 inlet;
#X obj 429 11 inlet;
#X text 466 12 octave;
#X obj 595 15 inlet;
#X obj 714 15 inlet;
#X text 298 10 bang to pause/resume;
#X text 306 163 Calculate the index in the array corresponding to the
first potential pitch for the current pitch inputted. The first potential
pitch is always c in our data representation.;
#X text 347 241 We want all potential pitches for the current pitch.
This can be thought of as a full row in the transition matrix so we
read 12 items in the array starting from the index as calculated by
the current pitch.;
#X text 327 466 Combine list of pitches and probabilities to format
accepted by the weight abstraction.;
#X text 188 558 Calculate next pitch.;
#X obj 516 13 inlet;
#X text 553 12 tempo;
#X obj 429 50 s \$0-octave;
#X obj 516 52 s \$0-tempo;
#X obj 595 54 s \$0-delay-factor;
#X obj 363 559 r \$0-tempo;
#X obj 203 281 array get \$1;
#X obj 135 551 weight;
#N canvas 401 25 1214 670 rhythm 0;
#X obj 246 143 loadbang;
#X obj 171 206 list;
#X obj 273 298 alternatively-combine-two-lists;
#X obj 149 282 list;
#X obj 170 230 t b l;
#X obj 273 323 t b l;
#X text 346 243 Combine list of pitches and probabilities to format
accepted by the weight abstraction.;
#X text 327 392 Calculate next pitch.;
#X obj 271 393 weight;
#X obj 148 36 inlet;
#X obj 208 600 outlet;
#X obj 358 570 outlet;
#X text 353 590 delayed current note (symbol);
#X text 131 627 current midi note;
#X obj 729 31 inlet;
#X text 728 7 tempo;
#X obj 729 362 bpm2ms;
#X text 88 6 current note symbol;
#X obj 208 572 note2midi;
#X obj 112 541 symbol;
#X obj 81 513 delay;
#X obj 301 607 outlet;
#X obj 161 514 symbol;
#X text 297 629 duration;
#X obj 301 522 * 0.95;
#X obj 219 432 * 500;
#X text 332 432 convert tempo in beats per minute to the millisecond
duration of a beat \, then multiply the number of beats we're holding
by this value to set the delay;
#X obj 219 458 t b f f;
#X text 356 519 set the duration of the current note to be 95% of the
rhythm;
#X obj 81 482 / 1;
#X obj 27 455 r \$0-delay-factor;
#X obj 234 540 r \$0-octave;
#X text 635 559 This patch is adapted from the rhythm subpatch provided
by Michael Edwards at http://michael-edwards.org/class/edi/music2d/markov.html
;
#X text 245 13 first store the note that we're just about to play \,
then store it again so we can send it out another outlet after a delay
\, then calculate the duration for the note to be played.;
#X obj 171 122 note-duration-to-index;
#X obj 246 164 8;
#X obj 170 97 0.5;
#X obj 52 120 t s;
#X obj 81 120 t s;
#X obj 148 66 t b s s s;
#X text 275 175 We want all potential durations for the current pitch.
This can be thought of as a full row in the transition matrix so we
read 6 items in the array starting from the index as calculated by
the current pitch.;
#X text 315 103 Calculate the index in the array corresponding to the
first potential duration for the current pitch inputted. The first
potential duration is always 0.5 in our data representation.;
#X msg 142 263 0.5 1 1.5 2 2.5 3 3.5 4;
#X obj 171 182 array get \$2;
#X msg 74 31 d;
#X obj 76 57 symbol;
#X obj 383 345 r \$0-rhythm-temp;
#X obj 303 366 vary-prob-temp;
#X connect 0 0 35 0;
#X connect 1 0 4 0;
#X connect 2 0 5 0;
#X connect 3 0 2 0;
#X connect 4 0 42 0;
#X connect 4 1 2 1;
#X connect 5 0 8 0;
#X connect 5 1 47 0;
#X connect 8 0 25 0;
#X connect 9 0 39 0;
#X connect 14 0 16 0;
#X connect 16 0 25 1;
#X connect 18 0 10 0;
#X connect 19 0 11 0;
#X connect 20 0 19 0;
#X connect 22 0 18 0;
#X connect 24 0 21 0;
#X connect 25 0 27 0;
#X connect 27 0 22 0;
#X connect 27 1 24 0;
#X connect 27 2 29 0;
#X connect 29 0 20 0;
#X connect 30 0 29 1;
#X connect 31 0 18 1;
#X connect 34 0 43 0;
#X connect 35 0 43 1;
#X connect 36 0 34 0;
#X connect 37 0 19 1;
#X connect 38 0 22 1;
#X connect 39 0 36 0;
#X connect 39 1 34 1;
#X connect 39 2 37 0;
#X connect 39 3 38 0;
#X connect 42 0 3 0;
#X connect 43 0 1 0;
#X connect 44 0 45 0;
#X connect 45 0 39 0;
#X connect 46 0 47 1;
#X connect 47 0 8 1;
#X restore 68 591 pd rhythm;
#X obj 174 521 vary-prob-temp;
#X text 753 15 Pitch Probability temperature;
#X obj 714 54 s \$0-pitch-temp;
#X obj 282 505 r \$0-pitch-temp;
#X obj 941 17 inlet;
#X text 982 17 Rhythm Probability temperature;
#X text 630 16 delay factor;
#X obj 941 56 s \$0-rhythm-temp;
#X text 726 81 Low temperature value -> More deterministic.;
#X text 726 99 High Temperature value -> More random.;
#X text 439 529 The rhythm subpatch calculates the duration the pitch
should be played for. It outputs a midi value \, a duration in milliseconds
and sends a bang out the rightmost outlet for the next pitch to start.
;
#X obj 67 667 outlet~;
#X obj 139 614 127;
#X obj 140 592 loadbang;
#X obj 67 632 sin-synth;
#X connect 0 0 20 1;
#X connect 1 0 40 0;
#X connect 3 0 4 0;
#X connect 4 0 40 1;
#X connect 5 0 1 0;
#X connect 6 0 5 0;
#X connect 6 1 1 1;
#X connect 7 0 11 0;
#X connect 8 0 12 0;
#X connect 9 0 8 0;
#X connect 10 0 9 0;
#X connect 11 0 10 0;
#X connect 11 1 8 1;
#X connect 12 0 41 0;
#X connect 12 1 43 0;
#X connect 15 0 14 0;
#X connect 15 1 14 1;
#X connect 17 0 22 0;
#X connect 18 0 20 0;
#X connect 19 0 22 0;
#X connect 20 0 6 0;
#X connect 21 0 20 0;
#X connect 22 0 16 0;
#X connect 24 0 0 0;
#X connect 25 0 36 0;
#X connect 27 0 38 0;
#X connect 28 0 45 0;
#X connect 34 0 37 0;
#X connect 39 0 42 1;
#X connect 40 0 7 0;
#X connect 41 0 42 0;
#X connect 42 0 13 0;
#X connect 42 0 57 0;
#X connect 42 1 57 1;
#X connect 42 2 18 0;
#X connect 43 0 41 1;
#X connect 46 0 43 1;
#X connect 47 0 50 0;
#X connect 55 0 57 2;
#X connect 56 0 55 0;
#X connect 57 0 54 0;
